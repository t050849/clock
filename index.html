<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>全螢幕時鐘 - 適配 iPad 2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            background-color: #000000;
            font-family: 'Courier New', 'Monaco', monospace;
            overflow: hidden;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 40px;
            cursor: pointer;
        }

        .container {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
            position: relative;
        }

        .top-section {
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
        }

        .date-display {
            font-size: 32px;
            color: #00FF00;
            font-weight: bold;
            letter-spacing: 2px;
            transition: font-size 0.3s ease;
        }

        .middle-section {
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
        }

        .time-display {
            font-size: 160px;
            color: #FFFFFF;
            font-weight: bold;
            letter-spacing: 8px;
            line-height: 1;
            text-align: center;
            transition: font-size 0.3s ease;
        }

        .bottom-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .weather-display {
            font-size: 28px;
            color: #00FF00;
            font-weight: bold;
            letter-spacing: 1px;
            transition: font-size 0.3s ease;
        }

        .font-size-button {
            width: 12px;
            height: 12px;
            background-color: rgba(0, 255, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.4);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
            padding: 0;
            position: relative;
        }

        .font-size-button:hover {
            background-color: rgba(0, 255, 0, 0.5);
            border-color: rgba(0, 255, 0, 0.8);
        }

        .font-size-button:active {
            background-color: rgba(0, 255, 0, 0.7);
        }

        .font-size-popup {
            position: absolute;
            bottom: 30px;
            right: 0;
            background-color: rgba(0, 0, 0, 0.9);
            border: 2px solid rgba(0, 255, 0, 0.5);
            border-radius: 8px;
            padding: 15px;
            display: none;
            z-index: 1000;
            white-space: nowrap;
            max-width: 280px;
        }

        .font-size-popup.show {
            display: block;
        }

        .font-size-popup-content {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: center;
        }

        .popup-btn {
            width: 30px;
            height: 30px;
            background-color: rgba(0, 255, 0, 0.3);
            border: 1px solid rgba(0, 255, 0, 0.5);
            color: #00FF00;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 3px;
            transition: background-color 0.2s ease;
            -webkit-appearance: none;
            appearance: none;
            padding: 0;
        }

        .popup-btn:active {
            background-color: rgba(0, 255, 0, 0.6);
        }

        .popup-label {
            color: #00FF00;
            font-size: 12px;
            font-weight: bold;
            min-width: 35px;
            text-align: center;
        }

        .popup-section {
            margin-bottom: 12px;
        }

        .popup-section:last-child {
            margin-bottom: 0;
        }

        .popup-title {
            color: #00FF00;
            font-size: 10px;
            margin-bottom: 5px;
            text-align: center;
        }

        /* 針對舊版 Safari 的相容性調整 */
        body {
            display: -webkit-flex;
            -webkit-flex-direction: column;
            -webkit-justify-content: space-between;
        }

        .top-section {
            display: -webkit-flex;
            -webkit-justify-content: flex-start;
            -webkit-align-items: flex-start;
        }

        .middle-section {
            display: -webkit-flex;
            -webkit-justify-content: center;
            -webkit-align-items: center;
            -webkit-flex: 1;
        }

        .bottom-section {
            display: -webkit-flex;
            -webkit-justify-content: space-between;
            -webkit-align-items: flex-end;
        }

        .font-size-popup-content {
            display: -webkit-flex;
            -webkit-gap: 8px;
            -webkit-align-items: center;
            -webkit-justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-section">
            <div class="date-display" id="dateDisplay">2026年2月18日 週三</div>
        </div>

        <div class="middle-section">
            <div class="time-display" id="timeDisplay">00:00:00</div>
        </div>

        <div class="bottom-section">
            <div class="weather-display" id="weatherDisplay">蘆竹區 新興里 -- 度 --</div>
            <div>
                <button class="font-size-button" id="fontSizeBtn" title="調整字體"></button>
                <div class="font-size-popup" id="fontSizePopup">
                    <div class="popup-section">
                        <div class="popup-title">年月日</div>
                        <div class="font-size-popup-content">
                            <button class="popup-btn" id="decreaseBtn1">−</button>
                            <span class="popup-label" id="sizeLabel1">100%</span>
                            <button class="popup-btn" id="increaseBtn1">+</button>
                        </div>
                    </div>
                    <div class="popup-section">
                        <div class="popup-title">時間</div>
                        <div class="font-size-popup-content">
                            <button class="popup-btn" id="decreaseBtn2">−</button>
                            <span class="popup-label" id="sizeLabel2">100%</span>
                            <button class="popup-btn" id="increaseBtn2">+</button>
                        </div>
                    </div>
                    <div class="popup-section">
                        <div class="popup-title">溫度天氣</div>
                        <div class="font-size-popup-content">
                            <button class="popup-btn" id="decreaseBtn3">−</button>
                            <span class="popup-label" id="sizeLabel3">100%</span>
                            <button class="popup-btn" id="increaseBtn3">+</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== 全局變數 ====================
        var is12HourFormat = true;
        var currentWeather = '蘆竹區 新興里 -- 度 --';
        var fontSizeMultiplier1 = 1.0; // 年月日
        var fontSizeMultiplier2 = 1.0; // 時間
        var fontSizeMultiplier3 = 1.0; // 溫度天氣
        var popupOpen = false;
        
        // 桃園市蘆竹區新興里的坐標
        var userLatitude = 25.0642;
        var userLongitude = 121.3201;
        
        var weatherCheckInterval = 10 * 60 * 1000;
        var timeCheckInterval = 60 * 1000;

        // ==================== DOM 元素 ====================
        var dateDisplayElement = document.getElementById('dateDisplay');
        var timeDisplayElement = document.getElementById('timeDisplay');
        var weatherDisplayElement = document.getElementById('weatherDisplay');
        var fontSizeBtn = document.getElementById('fontSizeBtn');
        var fontSizePopup = document.getElementById('fontSizePopup');
        var decreaseBtn1 = document.getElementById('decreaseBtn1');
        var increaseBtn1 = document.getElementById('increaseBtn1');
        var sizeLabel1 = document.getElementById('sizeLabel1');
        var decreaseBtn2 = document.getElementById('decreaseBtn2');
        var increaseBtn2 = document.getElementById('increaseBtn2');
        var sizeLabel2 = document.getElementById('sizeLabel2');
        var decreaseBtn3 = document.getElementById('decreaseBtn3');
        var increaseBtn3 = document.getElementById('increaseBtn3');
        var sizeLabel3 = document.getElementById('sizeLabel3');

        // ==================== OpenWeatherMap API Key ====================
        var OPENWEATHERMAP_API_KEY = '5d13f280068f27e7b123c2b25149a95c';

        // ==================== 基礎字體大小 ====================
        var baseFontSizes = {
            date: 32,
            time: 160,
            weather: 28
        };

        // ==================== 格式化日期（西元年月日） ====================
        function formatDate(date) {
            var weekDays = ['週日', '週一', '週二', '週三', '週四', '週五', '週六'];
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            var day = date.getDate();
            var weekDay = weekDays[date.getDay()];

            return year + '年' + month + '月' + day + '日 ' + weekDay;
        }

        // ==================== 格式化時間 ====================
        function formatTime(date) {
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var seconds = date.getSeconds();

            var timeString;

            if (is12HourFormat) {
                var ampm = hours >= 12 ? 'PM' : 'AM';
                var displayHours = hours % 12;
                if (displayHours === 0) {
                    displayHours = 12;
                }
                timeString = padZero(ampm) + ' ' + padZero(displayHours) + ':' + padZero(minutes) + ':' + padZero(seconds);
            } else {
                timeString = padZero(hours) + ':' + padZero(minutes) + ':' + padZero(seconds);
            }

            return timeString;
        }

        // ==================== 補零函數 ====================
        function padZero(num) {
            var str = String(num);
            return str.length < 2 ? '0' + str : str;
        }

        // ==================== 更新時鐘顯示 ====================
        function updateClock() {
            var now = new Date();
            dateDisplayElement.textContent = formatDate(now);
            timeDisplayElement.textContent = formatTime(now);
        }

        // ==================== 切換時制 ====================
        function toggleTimeFormat() {
            is12HourFormat = !is12HourFormat;
            updateClock();
        }

        // ==================== 切換彈出窗口 ====================
        function togglePopup(e) {
            e.stopPropagation();
            popupOpen = !popupOpen;
            if (popupOpen) {
                fontSizePopup.classList.add('show');
            } else {
                fontSizePopup.classList.remove('show');
            }
        }

        // ==================== 關閉彈出窗口 ====================
        function closePopup() {
            popupOpen = false;
            fontSizePopup.classList.remove('show');
        }

        // ==================== 更新字體大小 ====================
        function updateFontSizes() {
            dateDisplayElement.style.fontSize = (baseFontSizes.date * fontSizeMultiplier1) + 'px';
            timeDisplayElement.style.fontSize = (baseFontSizes.time * fontSizeMultiplier2) + 'px';
            weatherDisplayElement.style.fontSize = (baseFontSizes.weather * fontSizeMultiplier3) + 'px';
            
            var percentage1 = Math.round(fontSizeMultiplier1 * 100);
            var percentage2 = Math.round(fontSizeMultiplier2 * 100);
            var percentage3 = Math.round(fontSizeMultiplier3 * 100);
            sizeLabel1.textContent = percentage1 + '%';
            sizeLabel2.textContent = percentage2 + '%';
            sizeLabel3.textContent = percentage3 + '%';

            // 儲存到本地存儲
            try {
                localStorage.setItem('fontSizeMultiplier1', fontSizeMultiplier1);
                localStorage.setItem('fontSizeMultiplier2', fontSizeMultiplier2);
                localStorage.setItem('fontSizeMultiplier3', fontSizeMultiplier3);
            } catch (e) {
                console.log('localStorage not available');
            }
        }

        // ==================== 減小年月日字體 ====================
        function decreaseFont1(e) {
            e.stopPropagation();
            if (fontSizeMultiplier1 > 0.5) {
                fontSizeMultiplier1 -= 0.1;
                fontSizeMultiplier1 = Math.round(fontSizeMultiplier1 * 10) / 10;
                updateFontSizes();
            }
        }

        // ==================== 增大年月日字體 ====================
        function increaseFont1(e) {
            e.stopPropagation();
            if (fontSizeMultiplier1 < 5.0) {
                fontSizeMultiplier1 += 0.1;
                fontSizeMultiplier1 = Math.round(fontSizeMultiplier1 * 10) / 10;
                updateFontSizes();
            }
        }

        // ==================== 減小時間字體 ====================
        function decreaseFont2(e) {
            e.stopPropagation();
            if (fontSizeMultiplier2 > 0.5) {
                fontSizeMultiplier2 -= 0.1;
                fontSizeMultiplier2 = Math.round(fontSizeMultiplier2 * 10) / 10;
                updateFontSizes();
            }
        }

        // ==================== 增大時間字體 ====================
        function increaseFont2(e) {
            e.stopPropagation();
            if (fontSizeMultiplier2 < 5.0) {
                fontSizeMultiplier2 += 0.1;
                fontSizeMultiplier2 = Math.round(fontSizeMultiplier2 * 10) / 10;
                updateFontSizes();
            }
        }

        // ==================== 減小溫度天氣字體 ====================
        function decreaseFont3(e) {
            e.stopPropagation();
            if (fontSizeMultiplier3 > 0.5) {
                fontSizeMultiplier3 -= 0.1;
                fontSizeMultiplier3 = Math.round(fontSizeMultiplier3 * 10) / 10;
                updateFontSizes();
            }
        }

        // ==================== 增大溫度天氣字體 ====================
        function increaseFont3(e) {
            e.stopPropagation();
            if (fontSizeMultiplier3 < 5.0) {
                fontSizeMultiplier3 += 0.1;
                fontSizeMultiplier3 = Math.round(fontSizeMultiplier3 * 10) / 10;
                updateFontSizes();
            }
        }

        // ==================== 天氣狀況中文轉換 ====================
        function translateWeather(weatherMain) {
            var weatherMap = {
                'Clear': '晴',
                'Clouds': '多雲',
                'Rain': '雨',
                'Drizzle': '毛毛雨',
                'Thunderstorm': '雷雨',
                'Snow': '雪',
                'Mist': '霧',
                'Fog': '霧',
                'Haze': '霾'
            };
            
            return weatherMap[weatherMain] || weatherMain;
        }

        // ==================== 取得天氣資訊 ====================
        function fetchWeather() {
            var apiUrl = 'https://api.openweathermap.org/data/2.5/weather?lat=' + userLatitude + '&lon=' + userLongitude + '&appid=' + OPENWEATHERMAP_API_KEY + '&units=metric&lang=zh_cn';

            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        try {
                            var data = JSON.parse(xhr.responseText);
                            var temp = Math.round(data.main.temp);
                            var weatherDescription = data.weather[0].main;
                            var weatherChinese = translateWeather(weatherDescription);

                            currentWeather = '蘆竹區 新興里 ' + temp + '度 ' + weatherChinese;
                            weatherDisplayElement.textContent = currentWeather;
                        } catch (error) {
                            console.log('Parse error:', error);
                            weatherDisplayElement.textContent = '蘆竹區 新興里 解析錯誤';
                        }
                    } else {
                        weatherDisplayElement.textContent = '蘆竹區 新興里 天氣取得失敗';
                        console.log('Weather API error:', xhr.status);
                    }
                }
            };

            xhr.onerror = function() {
                weatherDisplayElement.textContent = '蘆竹區 新興里 網路連接失敗';
            };

            xhr.open('GET', apiUrl, true);
            xhr.send();
        }

        // ==================== 網路校時 ====================
        function syncTimeWithAPI() {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    try {
                        var data = JSON.parse(xhr.responseText);
                        var serverTime = new Date(data.datetime);
                        var clientTime = new Date();
                        var timeDifference = serverTime.getTime() - clientTime.getTime();

                        if (Math.abs(timeDifference) > 1000) {
                            console.log('Time corrected by:', timeDifference, 'ms');
                        }
                    } catch (error) {
                        console.log('Time sync parse error:', error);
                    }
                }
            };

            xhr.onerror = function() {
                console.log('Time sync network error');
            };

            xhr.open('GET', 'https://worldtimeapi.org/api/timezone/Asia/Taipei', true);
            xhr.send();
        }

        // ==================== 初始化 ====================
        function init() {
            // 從本地存儲讀取字體大小
            try {
                var savedSize1 = localStorage.getItem('fontSizeMultiplier1');
                var savedSize2 = localStorage.getItem('fontSizeMultiplier2');
                var savedSize3 = localStorage.getItem('fontSizeMultiplier3');
                if (savedSize1) {
                    fontSizeMultiplier1 = parseFloat(savedSize1);
                }
                if (savedSize2) {
                    fontSizeMultiplier2 = parseFloat(savedSize2);
                }
                if (savedSize3) {
                    fontSizeMultiplier3 = parseFloat(savedSize3);
                }
            } catch (e) {
                console.log('localStorage not available');
            }

            // 更新初始時鐘
            updateClock();
            updateFontSizes();

            // 每秒更新時鐘
            setInterval(updateClock, 1000);

            // 每分鐘校時一次
            setInterval(syncTimeWithAPI, timeCheckInterval);

            // 立即取得天氣
            fetchWeather();

            // 每10分鐘更新天氣一次
            setInterval(fetchWeather, weatherCheckInterval);

            // 綁定點擊事件到整個版面（切換時制）
            document.body.onclick = function(event) {
                closePopup();
                if (event.target !== fontSizeBtn) {
                    toggleTimeFormat();
                }
            };

            // 綁定字體大小按鈕
            fontSizeBtn.onclick = togglePopup;
            decreaseBtn1.onclick = decreaseFont1;
            increaseBtn1.onclick = increaseFont1;
            decreaseBtn2.onclick = decreaseFont2;
            increaseBtn2.onclick = increaseFont2;
            decreaseBtn3.onclick = decreaseFont3;
            increaseBtn3.onclick = increaseFont3;
        }

        // ==================== 文件準備完成後執行 ====================
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
