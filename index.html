<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>iPad 2 時鐘 - 全功能微調版</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html {
            width: 100%; height: 100%;
            background-color: #000000;
            font-family: Helvetica, Arial, sans-serif;
            overflow: hidden;
        }

        .top-section { position: absolute; top: 60px; left: 40px; }
        .bottom-section { position: absolute; bottom: 40px; left: 40px; right: 40px; }
        .middle-section { 
            position: absolute; top: 50%; left: 0; width: 100%; text-align: center;
            -webkit-transform: translateY(-50%); transform: translateY(-50%);
        }

        .date-display { 
            font-size: 32px; color: #FFFF00; font-weight: bold; display: block;
            -webkit-transform-origin: left top; transform-origin: left top;
        }
        .lunar-display { 
            font-size: 22px; color: #FFFF00; font-weight: bold; display: block; margin-top: 5px;
            -webkit-transform-origin: left top; transform-origin: left top;
        }
        .time-display { 
            font-size: 160px; color: #FFFFFF; font-weight: bold; white-space: nowrap; 
            display: inline-block; -webkit-transform-origin: center center; transform-origin: center center;
        }
        .weather-display { 
            font-size: 28px; color: #FFFF00; font-weight: bold; display: flex; align-items: center; 
            -webkit-transform-origin: left bottom; transform-origin: left bottom;
        }
        
        .holiday-red { color: #FF0000 !important; }
        .location-text { margin-right: 10px; }
        .temp-text { margin-right: 15px; }
        .weather-icon { display: inline-block; margin-right: 10px; font-size: 1.2em; }
        .rain-chance { color: #00CED1; font-size: 0.9em; }

        .control-button {
            position: absolute; bottom: 0; right: 0; width: 30px; height: 30px; 
            background: rgba(255,255,0,0.1); border: 1px solid rgba(255,255,0,0.3); border-radius: 15px;
        }

        .main-popup {
            position: absolute; bottom: 40px; right: 10px; background: rgba(10, 10, 10, 0.98); 
            border: 2px solid #FFFF00; padding: 15px; display: none; z-index: 1000; width: 340px;
            max-height: 85%; overflow-y: scroll; -webkit-overflow-scrolling: touch;
        }
        .show { display: block; }
        .section-title { color: #FFFF00; font-size: 13px; margin: 15px 0 8px; text-align: center; border-top: 1px dotted #444; padding-top: 10px; }
        .pos-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 5px; background: #222; padding: 5px; border-radius: 4px; }
        .pos-label { color: #fff; font-size: 11px; width: 60px; font-weight: bold; }
        .btn { background: #333; color: #FFFF00; border: 1px solid #FFFF00; padding: 6px; margin: 2px; border-radius: 4px; font-size: 12px; }
        .btn-sm { width: 35px; font-weight: bold; }
        .swatch { display: inline-block; width: 25px; height: 25px; margin: 3px; border: 1px solid #666; border-radius: 3px; }
    </style>
</head>
<body>

    <div class="top-section">
        <div id="dateDisplay" class="date-display">載入中...</div>
        <div id="lunarDisplay" class="lunar-display">載入中...</div>
    </div>

    <div class="middle-section">
        <div id="timeDisplay" class="time-display">00:00:00</div>
    </div>

    <div class="bottom-section">
        <div id="weatherDisplay" class="weather-display">
            <span class="location-text">讀取中...</span>
        </div>
        <button id="controlBtn" class="control-button"></button>
    </div>

    <div id="mainPopup" class="main-popup">
        <button class="btn" style="width:100%" onclick="toggleFormat()">切換 12/24H 制</button>

        <div class="section-title">文字位置 (方向鍵)</div>
        <div class="pos-row">
            <span class="pos-label">西元日期</span>
            <button class="btn btn-sm" onclick="adjPos('date', 'x', -5)">←</button>
            <button class="btn btn-sm" onclick="adjPos('date', 'x', 5)">→</button>
            <button class="btn btn-sm" onclick="adjPos('date', 'y', -5)">↑</button>
            <button class="btn btn-sm" onclick="adjPos('date', 'y', 5)">↓</button>
        </div>
        <div class="pos-row">
            <span class="pos-label">農曆日期</span>
            <button class="btn btn-sm" onclick="adjPos('lunar', 'x', -5)">←</button>
            <button class="btn btn-sm" onclick="adjPos('lunar', 'x', 5)">→</button>
            <button class="btn btn-sm" onclick="adjPos('lunar', 'y', -5)">↑</button>
            <button class="btn btn-sm" onclick="adjPos('lunar', 'y', 5)">↓</button>
        </div>
        <div class="pos-row">
            <span class="pos-label">中央時間</span>
            <button class="btn btn-sm" onclick="adjPos('time', 'x', -5)">←</button>
            <button class="btn btn-sm" onclick="adjPos('time', 'x', 5)">→</button>
            <button class="btn btn-sm" onclick="adjPos('time', 'y', -5)">↑</button>
            <button class="btn btn-sm" onclick="adjPos('time', 'y', 5)">↓</button>
        </div>
        <div class="pos-row">
            <span class="pos-label">底部天氣</span>
            <button class="btn btn-sm" onclick="adjPos('weather', 'x', -5)">←</button>
            <button class="btn btn-sm" onclick="adjPos('weather', 'x', 5)">→</button>
            <button class="btn btn-sm" onclick="adjPos('weather', 'y', -5)">↑</button>
            <button class="btn btn-sm" onclick="adjPos('weather', 'y', 5)">↓</button>
        </div>

        <div class="section-title">字體縮放 (大小)</div>
        <div class="pos-row">
            <span class="pos-label">西元日期</span>
            <button class="btn" style="flex:1" onclick="adjScale('date', -0.05)">小 -</button>
            <button class="btn" style="flex:1" onclick="adjScale('date', 0.05)">大 +</button>
        </div>
        <div class="pos-row">
            <span class="pos-label">農曆日期</span>
            <button class="btn" style="flex:1" onclick="adjScale('lunar', -0.05)">小 -</button>
            <button class="btn" style="flex:1" onclick="adjScale('lunar', 0.05)">大 +</button>
        </div>
        <div class="pos-row">
            <span class="pos-label">時間(寬/高)</span>
            <button class="btn btn-sm" onclick="adjTimeScale('x', -0.05)">W-</button>
            <button class="btn btn-sm" onclick="adjTimeScale('x', 0.05)">W+</button>
            <button class="btn btn-sm" onclick="adjTimeScale('y', -0.1)">H-</button>
            <button class="btn btn-sm" onclick="adjTimeScale('y', 0.1)">H+</button>
        </div>
        <div class="pos-row">
            <span class="pos-label">底部天氣</span>
            <button class="btn" style="flex:1" onclick="adjScale('weather', -0.1)">小 -</button>
            <button class="btn" style="flex:1" onclick="adjScale('weather', 0.1)">大 +</button>
        </div>

        <div class="section-title">字體顏色</div>
        <div id="palette1" class="color-row"></div>
        <div id="palette2" class="color-row"></div>
        <div id="palette3" class="color-row"></div>

        <button class="btn" style="width:100%; margin-top:20px; background:#400; color:#fff; border:none;" onclick="closeMenu()">儲存並關閉</button>
    </div>

    <script>
        var is12H = true;
        // 初始化各行狀態
        var state = {
            date: { scale: 1.0, x: 0, y: 0 },
            lunar: { scale: 1.0, x: 0, y: 0 },
            time: { sx: 1.0, sy: 1.0, x: 0, y: 0 },
            weather: { scale: 1.0, x: 0, y: 0 }
        };

        var colors = ['#FF0000', '#FF7F00', '#FFFF00', '#00FF00', '#0000FF', '#FFFFFF', '#FF69B4', '#00CED1'];
        var dDiv = document.getElementById('dateDisplay'),
            lDiv = document.getElementById('lunarDisplay'),
            tDiv = document.getElementById('timeDisplay'),
            wDiv = document.getElementById('weatherDisplay'),
            menu = document.getElementById('mainPopup');

        var holidays = { "1-1": "元旦", "2-28": "和平紀念日", "4-4": "兒童節", "4-5": "清明節", "5-1": "勞動節", "10-10": "國慶日" };

        function update() {
            var now = new Date();
            var m = now.getMonth() + 1, d = now.getDate(), dayOfWeek = now.getDay();
            var dayKey = m + "-" + d;
            var isHoliday = !!holidays[dayKey], isWeekend = (dayOfWeek === 0 || dayOfWeek === 6);
            
            var days = ['週日', '週一', '週二', '週三', '週四', '週五', '週六'];
            var weekDaySpan = (isHoliday || isWeekend) ? '<span class="holiday-red">' + days[dayOfWeek] + '</span>' : days[dayOfWeek];
            dDiv.innerHTML = now.getFullYear() + '年' + m + '月' + d + '日 ' + weekDaySpan;
            
            var rocYear = now.getFullYear() - 1911;
            // 2026/3/1 農曆正月十三
            var lunarMonth = 1, lunarDay = 13; 
            var dayText = (lunarDay <= 10) ? ["初一","初二","初三","初四","初五","初六","初七","初八","初九","初十"][lunarDay-1] : lunarDay + "日";
            var holidayLabel = isHoliday ? ' <span class="holiday-red">(' + holidays[dayKey] + ')</span>' : "";
            lDiv.innerHTML = "農曆 " + rocYear + "年" + lunarMonth + "月" + dayText + holidayLabel;

            var hh = now.getHours(), mm = now.getMinutes(), ss = now.getSeconds();
            var ampm = is12H ? (hh >= 12 ? "PM " : "AM ") : "";
            if (is12H) { hh = hh % 12; if (hh === 0) hh = 12; }
            if (hh < 10) hh = "0" + hh;
            if (mm < 10) mm = "0" + mm;
            if (ss < 10) ss = "0" + ss;
            tDiv.innerHTML = ampm + hh + ":" + mm + ":" + ss;
        }

        function applyAllTransforms() {
            dDiv.style.webkitTransform = "translate("+state.date.x+"px, "+state.date.y+"px) scale("+state.date.scale+")";
            dDiv.style.transform = dDiv.style.webkitTransform;

            lDiv.style.webkitTransform = "translate("+state.lunar.x+"px, "+state.lunar.y+"px) scale("+state.lunar.scale+")";
            lDiv.style.transform = lDiv.style.webkitTransform;

            tDiv.style.webkitTransform = "translate("+state.time.x+"px, "+state.time.y+"px) scale("+state.time.sx+", "+state.time.sy+")";
            tDiv.style.transform = tDiv.style.webkitTransform;

            wDiv.style.webkitTransform = "translate("+state.weather.x+"px, "+state.weather.y+"px) scale("+state.weather.scale+")";
            wDiv.style.transform = wDiv.style.webkitTransform;
        }

        function adjPos(target, axis, val) {
            state[target][axis] += val;
            applyAllTransforms();
        }

        function adjScale(type, val) {
            state[type].scale += val;
            applyAllTransforms();
        }

        function adjTimeScale(axis, val) {
            if(axis === 'x') state.time.sx += val;
            else state.time.sy += val;
            applyAllTransforms();
        }

        function toggleFormat() { is12H = !is12H; update(); }
        
        function getWeather() {
            var url = 'https://api.openweathermap.org/data/2.5/weather?lat=25.0074129&lon=121.2685473&appid=5d13f280068f27e7b123c2b25149a95c&units=metric&lang=zh_tw';
            var xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var data = JSON.parse(xhr.responseText);
                    var temp = Math.round(data.main.temp);
                    var icon = (data.weather[0].description.includes('晴')) ? '☀️' : '☁️';
                    var rain = data.clouds ? data.clouds.all : 0;
                    wDiv.innerHTML = '<span class="location-text">新興里</span><span class="temp-text">'+temp+'°C</span><span class="weather-icon">'+icon+'</span><span class="rain-chance">☔ '+rain+'%</span>';
                }
            };
            xhr.send();
        }

        function initPalettes() {
            for(var i=1; i<=3; i++) {
                var container = document.getElementById('palette' + i);
                for(var j=0; j<colors.length; j++) {
                    var s = document.createElement('div');
                    s.className = 'swatch'; s.style.backgroundColor = colors[j];
                    (function(t, c){
                        s.onclick = function() {
                            if(t === 1) { dDiv.style.color = c; lDiv.style.color = c; }
                            if(t === 2) tDiv.style.color = c;
                            if(t === 3) wDiv.style.color = c;
                        };
                    })(i, colors[j]);
                    container.appendChild(s);
                }
            }
        }

        document.getElementById('controlBtn').onclick = function(e) {
            e.stopPropagation();
            menu.className = (menu.className === "main-popup") ? "main-popup show" : "main-popup";
        };

        function closeMenu() { menu.className = "main-popup"; }

        initPalettes();
        setInterval(update, 1000);
        update();
        getWeather();
        setInterval(getWeather, 600000);
    </script>
</body>
</html>
