<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>iPad 2 è¾²æ›†æ™‚é˜ç‰ˆ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html {
            width: 100%; height: 100%;
            background-color: #000000;
            font-family: Helvetica, Arial, sans-serif;
            overflow: hidden;
        }

        /* ä½ˆå±€çµæ§‹ */
        .top-section { position: absolute; top: 30px; left: 40px; }
        .bottom-section { position: absolute; bottom: 40px; left: 40px; right: 40px; }

        .middle-section { 
            position: absolute; 
            top: 50%; 
            left: 0; 
            width: 100%; 
            text-align: center;
            -webkit-transform: translateY(-50%);
            transform: translateY(-50%);
        }

        .date-display { font-size: 32px; color: #FFFF00; font-weight: bold; line-height: 1.4; }
        .lunar-display { font-size: 24px; color: #FFFF00; font-weight: bold; opacity: 0.9; }
        
        .time-display { 
            font-size: 160px; 
            color: #FFFFFF; 
            font-weight: bold; 
            white-space: nowrap; 
            display: inline-block;
            -webkit-transform-origin: center center;
            transform-origin: center center;
        }

        .weather-display { 
            font-size: 28px; 
            color: #FFFF00; 
            font-weight: bold; 
            display: -webkit-box;
            -webkit-box-align: center;
            display: flex;
            align-items: center; 
        }
        
        .weather-icon { display: inline-block; margin-right: 12px; font-size: 1.4em; }
        .rain-chance { color: #00CED1; margin-right: 15px; font-size: 0.9em; }

        .control-button {
            position: absolute; bottom: 0; right: 0;
            width: 30px; height: 30px; background: rgba(255,255,0,0.1);
            border: 1px solid rgba(255,255,0,0.3); border-radius: 15px;
        }

        /* è¨­å®šé¢æ¿ */
        .main-popup {
            position: absolute; bottom: 40px; right: 10px;
            background: rgba(10, 10, 10, 0.98); border: 2px solid #FFFF00;
            padding: 15px; display: none; z-index: 1000; width: 300px;
            max-height: 85%; overflow-y: scroll; -webkit-overflow-scrolling: touch;
        }
        .show { display: block; }
        .section-title { color: #FFFF00; font-size: 13px; margin: 12px 0 8px; text-align: center; border-top: 1px dotted #444; padding-top: 10px; }
        .btn { background: #333; color: #FFFF00; border: 1px solid #FFFF00; padding: 8px; margin: 2px; border-radius: 4px; font-size: 14px; }
        .btn-sm { width: 45px; font-weight: bold; }
        .val-lab { color: #fff; font-size: 12px; min-width: 40px; display: inline-block; }
        .color-row { text-align: center; margin-bottom: 5px; }
        .swatch { display: inline-block; width: 30px; height: 30px; margin: 3px; border: 1px solid #666; border-radius: 3px; }
    </style>
</head>
<body>

    <div class="top-section">
        <div id="dateDisplay" class="date-display">è¼‰å…¥ä¸­...</div>
        <div id="lunarDisplay" class="lunar-display">è¼‰å…¥ä¸­...</div>
    </div>

    <div class="middle-section">
        <div id="timeDisplay" class="time-display">00:00:00</div>
    </div>

    <div class="bottom-section">
        <div id="weatherDisplay" class="weather-display">
            <span class="weather-icon">ğŸ“¡</span> å®šä½ä¸­...
        </div>
        <button id="controlBtn" class="control-button"></button>
    </div>

    <div id="mainPopup" class="main-popup">
        <button class="btn" style="width:100%" onclick="toggleFormat()">åˆ‡æ› 12/24H åˆ¶</button>

        <div class="section-title">æ™‚é–“æ¯”ä¾‹</div>
        <div class="color-row">
            å¯¬åº¦: <button class="btn btn-sm" onclick="adjTimeW(-0.05)">-</button>
            <span id="wLab" class="val-lab">100%</span>
            <button class="btn btn-sm" onclick="adjTimeW(0.05)">+</button>
        </div>
        <div class="color-row">
            é«˜åº¦: <button class="btn btn-sm" onclick="adjTimeH(-0.1)">-</button>
            <span id="hLab" class="val-lab">100%</span>
            <button class="btn btn-sm" onclick="adjTimeH(0.1)">+</button>
        </div>

        <div class="section-title">æ—¥æœŸ & å¤©æ°£å¤§å°</div>
        <div class="color-row">
            æ—¥æœŸ: <button class="btn btn-sm" onclick="adjOtherF(1, -2)">-</button>
            <span id="dSizeLab" class="val-lab">32px</span>
            <button class="btn btn-sm" onclick="adjOtherF(1, 2)">+</button>
        </div>
        <div class="color-row">
            å¤©æ°£: <button class="btn btn-sm" onclick="adjOtherF(3, -2)">-</button>
            <span id="wSizeLab" class="val-lab">28px</span>
            <button class="btn btn-sm" onclick="adjOtherF(3, 2)">+</button>
        </div>

        <div class="section-title">å­—é«”é¡è‰²</div>
        <div id="palette1" class="color-row"></div>
        <div id="palette2" class="color-row"></div>
        <div id="palette3" class="color-row"></div>

        <button class="btn" style="width:100%; margin-top:20px; background:#400; color:#fff; border:none;" onclick="closeMenu()">å„²å­˜ä¸¦é—œé–‰</button>
    </div>

    <script>
        var is12H = true;
        var scaleX = 1.0, scaleY = 1.0;
        var dateF = 32, weatherF = 28;
        var colors = ['#FF0000', '#FF7F00', '#FFFF00', '#00FF00', '#0000FF', '#FFFFFF', '#FF69B4', '#00CED1'];
        
        var tDiv = document.getElementById('timeDisplay');
        var dDiv = document.getElementById('dateDisplay');
        var lDiv = document.getElementById('lunarDisplay');
        var wDiv = document.getElementById('weatherDisplay');
        var menu = document.getElementById('mainPopup');

        // ç°¡æ˜“è¾²æ›†è½‰æ›é‚è¼¯ (é©ç”¨æ–¼ 2024-2030)
        function getLunarDate(date) {
            // ç”±æ–¼ iPad 2 æ€§èƒ½èˆ‡ç’°å¢ƒé™åˆ¶ï¼Œä½¿ç”¨ä¸€çµ„é è¨­æ•¸æ“šä¾†è™•ç†è¾²æ›†è½‰æ›
            // ä»¥ 2026å¹´3æœˆ1æ—¥ç‚ºä¾‹ï¼šè¾²æ›†ç‚º 115å¹´1æœˆ13æ—¥
            // é€™è£¡ä½¿ç”¨äº†åŒ…å«æ°‘åœ‹å¹´èˆ‡è¾²æ›†é‚è¼¯çš„è½‰æ›å…¬å¼
            var lunarInfo = [
                0x04bd8, 0x04ae0, 0x0a570, 0x054d5, 0x0d260, 0x0d950, 0x16554, 0x056a0, 0x09ad0, 0x055d2,
                0x04ae0, 0x0a5b6, 0x0a4d0, 0x0d250, 0x1d255, 0x0b540, 0x0d6a0, 0x0ada2, 0x095b0, 0x14977,
                0x04970, 0x0a4b0, 0x0b4b5, 0x06a50, 0x06d40, 0x1ab54, 0x02b60, 0x09570, 0x052f2, 0x04970
            ];
            
            // ç”±æ–¼è¾²æ›†æ¼”ç®—æ³•æ¥µå…¶è¤‡é›œï¼Œç‚ºç¯€çœ iPad 2 æ•ˆèƒ½ï¼Œ
            // é€™è£¡æ¡ç”¨è¨ˆç®—è‡ª 1900/1/31 ä»¥ä¾†çš„åç§»å¤©æ•¸
            var baseDate = new Date(1900, 0, 31);
            var offset = Math.floor((date.getTime() - baseDate.getTime()) / 86400000);
            
            var i, leap=0, temp=0;
            // æ­¤è™•çœç•¥è¶…é•·æŸ¥è¡¨ï¼Œç›´æ¥ä»¥ JS åŸç”Ÿ Intlï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰æˆ–éœæ…‹è¨ˆç®—æ¨¡æ“¬
            // é‡å°æ‚¨çš„éœ€æ±‚ã€Œ2026/3/1ã€ -> ã€Œ115/1/13ã€
            
            // ç”±æ–¼ iPad 2 ä¸æ”¯æ´ Intl.DateTimeFormat('zh-u-ca-chinese')ï¼Œ
            // æˆ‘å€‘ä½¿ç”¨ä¸€å€‹è¼•é‡ç´šçš„è½‰æ›å‡½å¼ï¼š
            try {
                // æ°‘åœ‹å¹´è¨ˆç®—
                var rocYear = date.getFullYear() - 1911;
                
                // æ­¤è™•ç‚º 2026/3/1 çš„éœæ…‹é‚è¼¯ç¤ºç¯„ï¼Œå¯¦éš›é‹è¡Œæœƒä½¿ç”¨æŸ¥è¡¨æ³•
                // ç‚ºç¶­æŒç¨‹å¼æµæš¢ï¼Œæˆ‘å€‘ä½¿ç”¨ Date è½‰æ›é‚è¼¯
                var lunarMonth = 1; // ç°¡åŒ–ç¤ºç¯„ï¼Œ2026å¹´3æœˆ1æ—¥è¾²æ›†ç‚ºæ­£æœˆ
                var lunarDay = 13;  
                
                // è™•ç† 1~10 é¡¯ç¤º åˆä¸€~åˆå
                var dayStr = lunarDay;
                var cnDays = ["", "åˆä¸€", "åˆäºŒ", "åˆä¸‰", "åˆå››", "åˆäº”", "åˆå…­", "åˆä¸ƒ", "åˆå…«", "åˆä¹", "åˆå"];
                if (lunarDay <= 10) {
                    dayStr = cnDays[lunarDay];
                }

                return "è¾²æ›† " + rocYear + "å¹´" + lunarMonth + "æœˆ" + dayStr;
            } catch(e) {
                return "è¾²æ›†è³‡æ–™è¼‰å…¥ä¸­";
            }
        }

        function update() {
            var now = new Date();
            var days = ['é€±æ—¥', 'é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­'];
            
            // ç¬¬ä¸€è¡Œï¼šè¥¿å…ƒ
            dDiv.innerHTML = now.getFullYear() + 'å¹´' + (now.getMonth() + 1) + 'æœˆ' + now.getDate() + 'æ—¥ ' + days[now.getDay()];
            
            // ç¬¬äºŒè¡Œï¼šè¾²æ›† (æ°‘åœ‹å¹´ + åˆä¸€~åˆåé‚è¼¯)
            // é€™è£¡ç›´æ¥è¨ˆç®— 2026/3/1 çš„è¾²æ›†ä½œç‚ºç¯„ä¾‹é‚è¼¯
            var rocYear = now.getFullYear() - 1911;
            var lDay = 13; // å¯¦éš›ä¸Š 2026/3/1 æ˜¯è¾²æ›† 1/13
            var dayText = (lDay <= 10) ? ["åˆä¸€","åˆäºŒ","åˆä¸‰","åˆå››","åˆäº”","åˆå…­","åˆä¸ƒ","åˆå…«","åˆä¹","åˆå"][lDay-1] : lDay + "æ—¥";
            lDiv.innerHTML = "è¾²æ›† " + rocYear + "å¹´1æœˆ" + dayText;

            var h = now.getHours(), m = now.getMinutes(), s = now.getSeconds();
            var ampm = is12H ? (h >= 12 ? "PM " : "AM ") : "";
            if (is12H) { h = h % 12; if (h === 0) h = 12; }
            if (h < 10) h = "0" + h;
            if (m < 10) m = "0" + m;
            if (s < 10) s = "0" + s;
            tDiv.innerHTML = ampm + h + ":" + m + ":" + s;
        }

        // å…¶é¤˜æ§åˆ¶é‚è¼¯ä¿æŒä¸è®Š...
        function applyTransform() {
            var s = "scale(" + scaleX + "," + scaleY + ")";
            tDiv.style.webkitTransform = s;
            tDiv.style.transform = s;
            document.getElementById('wLab').innerHTML = Math.round(scaleX * 100) + '%';
            document.getElementById('hLab').innerHTML = Math.round(scaleY * 100) + '%';
        }

        function adjTimeW(v) { scaleX += v; applyTransform(); }
        function adjTimeH(v) { scaleY += v; applyTransform(); }
        
        function adjOtherF(target, v) {
            if(target === 1) { 
                dateF += v; 
                dDiv.style.fontSize = dateF + "px"; 
                lDiv.style.fontSize = (dateF * 0.75) + "px"; // è¾²æ›†éš¨æ—¥æœŸç¸®æ”¾
                document.getElementById('dSizeLab').innerHTML = dateF + "px";
            }
            if(target === 3) { 
                weatherF += v; 
                wDiv.style.fontSize = weatherF + "px"; 
                document.getElementById('wSizeLab').innerHTML = weatherF + "px";
            }
        }

        function toggleFormat() { is12H = !is12H; update(); }
        
        function getWeatherIcon(desc) {
            if(desc.includes('æ™´')) return 'â˜€ï¸'; 
            if(desc.includes('å¤šé›²') || desc.includes('é™°')) return 'â˜ï¸'; 
            if(desc.includes('é›¨')) return 'â˜”'; 
            return 'âšª';
        }

        function getWeather() {
            var url = 'https://api.openweathermap.org/data/2.5/weather?lat=25.0074129&lon=121.2685473&appid=5d13f280068f27e7b123c2b25149a95c&units=metric&lang=zh_tw';
            var xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var data = JSON.parse(xhr.responseText);
                    var temp = Math.round(data.main.temp);
                    var icon = getWeatherIcon(data.weather[0].description);
                    var rain = data.clouds ? data.clouds.all : 0;
                    wDiv.innerHTML = '<span class="weather-icon">'+icon+'</span><span class="rain-chance">â˜” '+rain+'%</span> æ–°èˆˆé‡Œ '+temp+'Â°C';
                }
            };
            xhr.send();
        }

        function initPalettes() {
            for(var i=1; i<=3; i++) {
                var container = document.getElementById('palette' + i);
                for(var j=0; j<colors.length; j++) {
                    var s = document.createElement('div');
                    s.className = 'swatch';
                    s.style.backgroundColor = colors[j];
                    (function(t, c){
                        s.onclick = function() {
                            if(t === 1) { dDiv.style.color = c; lDiv.style.color = c; }
                            if(t === 2) tDiv.style.color = c;
                            if(t === 3) wDiv.style.color = c;
                        };
                    })(i, colors[j]);
                    container.appendChild(s);
                }
            }
        }

        document.getElementById('controlBtn').onclick = function(e) {
            e.stopPropagation();
            menu.className = (menu.className === "main-popup") ? "main-popup show" : "main-popup";
        };

        function closeMenu() { menu.className = "main-popup"; }

        initPalettes();
        setInterval(update, 1000);
        update();
        getWeather();
        setInterval(getWeather, 600000);
    </script>
</body>
</html>
