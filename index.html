<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>全螢幕時鐘 - 適配 iPad 2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            background-color: #000000;
            font-family: 'Courier New', 'Monaco', monospace;
            overflow: hidden;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 40px;
            cursor: pointer;
        }

        .container {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
            position: relative;
        }

        .top-section {
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
        }

        .date-display {
            font-size: 32px;
            color: #00FF00;
            font-weight: bold;
            letter-spacing: 2px;
            transition: font-size 0.3s ease;
        }

        .middle-section {
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
        }

        .time-display {
            font-size: 160px;
            color: #FFFFFF;
            font-weight: bold;
            letter-spacing: 8px;
            line-height: 1;
            text-align: center;
            transition: font-size 0.3s ease;
        }

        .bottom-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .weather-display {
            font-size: 28px;
            color: #00FF00;
            font-weight: bold;
            letter-spacing: 1px;
            transition: font-size 0.3s ease;
        }

        .font-size-button {
            width: 12px;
            height: 12px;
            background-color: rgba(0, 255, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.4);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
            padding: 0;
            position: relative;
        }

        .font-size-button:hover {
            background-color: rgba(0, 255, 0, 0.5);
            border-color: rgba(0, 255, 0, 0.8);
        }

        .font-size-button:active {
            background-color: rgba(0, 255, 0, 0.7);
        }

        .font-size-popup {
            position: absolute;
            bottom: 30px;
            right: 0;
            background-color: rgba(0, 0, 0, 0.9);
            border: 2px solid rgba(0, 255, 0, 0.5);
            border-radius: 8px;
            padding: 15px;
            display: none;
            z-index: 1000;
            white-space: nowrap;
        }

        .font-size-popup.show {
            display: block;
        }

        .font-size-popup-content {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: center;
        }

        .popup-btn {
            width: 30px;
            height: 30px;
            background-color: rgba(0, 255, 0, 0.3);
            border: 1px solid rgba(0, 255, 0, 0.5);
            color: #00FF00;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 3px;
            transition: background-color 0.2s ease;
            -webkit-appearance: none;
            appearance: none;
            padding: 0;
        }

        .popup-btn:active {
            background-color: rgba(0, 255, 0, 0.6);
        }

        .popup-label {
            color: #00FF00;
            font-size: 12px;
            font-weight: bold;
            min-width: 35px;
            text-align: center;
        }

        body {
            display: -webkit-flex;
            -webkit-flex-direction: column;
            -webkit-justify-content: space-between;
        }

        .top-section {
            display: -webkit-flex;
            -webkit-justify-content: flex-start;
            -webkit-align-items: flex-start;
        }

        .middle-section {
            display: -webkit-flex;
            -webkit-justify-content: center;
            -webkit-align-items: center;
            -webkit-flex: 1;
        }

        .bottom-section {
            display: -webkit-flex;
            -webkit-justify-content: space-between;
            -webkit-align-items: flex-end;
        }

        .font-size-popup-content {
            display: -webkit-flex;
            -webkit-gap: 8px;
            -webkit-align-items: center;
            -webkit-justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-section">
            <div class="date-display" id="dateDisplay">2026年2月18日 週三</div>
        </div>

        <div class="middle-section">
            <div class="time-display" id="timeDisplay">00:00:00</div>
        </div>

        <div class="bottom-section">
            <div class="weather-display" id="weatherDisplay">蘆竹區 新興里 -- 度 --</div>
            <div>
                <button class="font-size-button" id="fontSizeBtn" title="調整字體"></button>
                <div class="font-size-popup" id="fontSizePopup">
                    <div class="font-size-popup-content">
                        <button class="popup-btn" id="decreaseBtn">−</button>
                        <span class="popup-label" id="sizeLabel">100%</span>
                        <button class="popup-btn" id="increaseBtn">+</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var is12HourFormat = true;
        var currentWeather = '蘆竹區 新興里 -- 度 --';
        var fontSizeMultiplier = 1.0;
        var popupOpen = false;
        
        var userLatitude = 25.0642;
        var userLongitude = 121.3201;
        
        var weatherCheckInterval = 10 * 60 * 1000;
        var timeCheckInterval = 60 * 1000;

        var dateDisplayElement = document.getElementById('dateDisplay');
        var timeDisplayElement = document.getElementById('timeDisplay');
        var weatherDisplayElement = document.getElementById('weatherDisplay');
        var fontSizeBtn = document.getElementById('fontSizeBtn');
        var fontSizePopup = document.getElementById('fontSizePopup');
        var decreaseBtn = document.getElementById('decreaseBtn');
        var increaseBtn = document.getElementById('increaseBtn');
        var sizeLabel = document.getElementById('sizeLabel');

        var OPENWEATHERMAP_API_KEY = '5d13f280068f27e7b123c2b25149a95c';

        var baseFontSizes = {
            date: 32,
            time: 160,
            weather: 28
        };

        function formatDate(date) {
            var weekDays = ['週日', '週一', '週二', '週三', '週四', '週五', '週六'];
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            var day = date.getDate();
            var weekDay = weekDays[date.getDay()];

            return year + '年' + month + '月' + day + '日 ' + weekDay;
        }

        function formatTime(date) {
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var seconds = date.getSeconds();

            var timeString;

            if (is12HourFormat) {
                var ampm = hours >= 12 ? 'PM' : 'AM';
                var displayHours = hours % 12;
                if (displayHours === 0) {
                    displayHours = 12;
                }
                timeString = padZero(ampm) + ' ' + padZero(displayHours) + ':' + padZero(minutes) + ':' + padZero(seconds);
            } else {
                timeString = padZero(hours) + ':' + padZero(minutes) + ':' + padZero(seconds);
            }

            return timeString;
        }

        function padZero(num) {
            var str = String(num);
            return str.length < 2 ? '0' + str : str;
        }

        function updateClock() {
            var now = new Date();
            dateDisplayElement.textContent = formatDate(now);
            timeDisplayElement.textContent = formatTime(now);
        }

        function toggleTimeFormat() {
            is12HourFormat = !is12HourFormat;
            updateClock();
        }

        function togglePopup(e) {
            e.stopPropagation();
            popupOpen = !popupOpen;
            if (popupOpen) {
                fontSizePopup.classList.add('show');
            } else {
                fontSizePopup.classList.remove('show');
            }
        }

        function closePopup() {
            popupOpen = false;
            fontSizePopup.classList.remove('show');
        }

        function updateFontSizes() {
            dateDisplayElement.style.fontSize = (baseFontSizes.date * fontSizeMultiplier) + 'px';
            timeDisplayElement.style.fontSize = (baseFontSizes.time * fontSizeMultiplier) + 'px';
            weatherDisplayElement.style.fontSize = (baseFontSizes.weather * fontSizeMultiplier) + 'px';
            
            var percentage = Math.round(fontSizeMultiplier * 100);
            sizeLabel.textContent = percentage + '%';

            try {
                localStorage.setItem('fontSizeMultiplier', fontSizeMultiplier);
            } catch (e) {
                console.log('localStorage not available');
            }
        }

        function decreaseFont(e) {
            e.stopPropagation();
            if (fontSizeMultiplier > 0.5) {
                fontSizeMultiplier -= 0.1;
                fontSizeMultiplier = Math.round(fontSizeMultiplier * 10) / 10;
                updateFontSizes();
            }
        }

        function increaseFont(e) {
            e.stopPropagation();
            if (fontSizeMultiplier < 2.0) {
                fontSizeMultiplier += 0.1;
                fontSizeMultiplier = Math.round(fontSizeMultiplier * 10) / 10;
                updateFontSizes();
            }
        }

        function translateWeather(weatherMain) {
            var weatherMap = {
                'Clear': '晴',
                'Clouds': '多雲',
                'Rain': '雨',
                'Drizzle': '毛毛雨',
                'Thunderstorm': '雷雨',
                'Snow': '雪',
                'Mist': '霧',
                'Fog': '霧',
                'Haze': '霾'
            };
            
            return weatherMap[weatherMain] || weatherMain;
        }

        function fetchWeather() {
            var apiUrl = 'https://api.openweathermap.org/data/2.5/weather?lat=' + userLatitude + '&lon=' + userLongitude + '&appid=' + OPENWEATHERMAP_API_KEY + '&units=metric&lang=zh_cn';

            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        try {
                            var data = JSON.parse(xhr.responseText);
                            var temp = Math.round(data.main.temp);
                            var weatherDescription = data.weather[0].main;
                            var weatherChinese = translateWeather(weatherDescription);

                            currentWeather = '蘆竹區 新興里 ' + temp + '度 ' + weatherChinese;
                            weatherDisplayElement.textContent = currentWeather;
                        } catch (error) {
                            console.log('Parse error:', error);
                            weatherDisplayElement.textContent = '蘆竹區 新興里 解析錯誤';
                        }
                    } else {
                        weatherDisplayElement.textContent = '蘆竹區 新興里 天氣取得失敗';
                        console.log('Weather API error:', xhr.status);
                    }
                }
            };

            xhr.onerror = function() {
                weatherDisplayElement.textContent = '蘆竹區 新興里 網路連接失敗';
            };

            xhr.open('GET', apiUrl, true);
            xhr.send();
        }

        function syncTimeWithAPI() {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    try {
                        var data = JSON.parse(xhr.responseText);
                        var serverTime = new Date(data.datetime);
                        var clientTime = new Date();
                        var timeDifference = serverTime.getTime() - clientTime.getTime();

                        if (Math.abs(timeDifference) > 1000) {
                            console.log('Time corrected by:', timeDifference, 'ms');
                        }
                    } catch (error) {
                        console.log('Time sync parse error:', error);
                    }
                }
            };

            xhr.onerror = function() {
                console.log('Time sync network error');
            };

            xhr.open('GET', 'https://worldtimeapi.org/api/timezone/Asia/Taipei', true);
            xhr.send();
        }

        function init() {
            try {
                var savedSize = localStorage.getItem('fontSizeMultiplier');
                if (savedSize) {
                    fontSizeMultiplier = parseFloat(savedSize);
                }
            } catch (e) {
                console.log('localStorage not available');
            }

            updateClock();
            updateFontSizes();

            setInterval(updateClock, 1000);
            setInterval(syncTimeWithAPI, timeCheckInterval);

            fetchWeather();
            setInterval(fetchWeather, weatherCheckInterval);

            document.body.onclick = function(event) {
                closePopup();
                if (event.target !== fontSizeBtn) {
                    toggleTimeFormat();
                }
            };

            fontSizeBtn.onclick = togglePopup;
            decreaseBtn.onclick = decreaseFont;
            increaseBtn.onclick = increaseFont;
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
